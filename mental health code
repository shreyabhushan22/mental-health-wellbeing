{"cells":[{"cell_type":"markdown","metadata":{"id":"Wf5KrEb6vrkR"},"source":["# Welcome to Colab!"]},{"cell_type":"code","source":["from google.colab import drive\n","drive.mount('/content/drive')\n","\n","# _____________________________________________\n","# Step 0 - Install required libs (run in Colab)\n","!pip install -q scikit-learn pandas flask-ngrok pyngrok joblib flask\n","\n","# basic imports\n","import os\n","import pandas as pd\n","import numpy as np\n","from sklearn.model_selection import train_test_split\n","from sklearn.ensemble import RandomForestClassifier\n","from sklearn.preprocessing import OrdinalEncoder, LabelEncoder\n","from sklearn.metrics import classification_report, confusion_matrix, accuracy_score\n","import joblib\n","\n","print(\"Setup done. Ready to load data.\")\n","\n","# _____________________________________________\n"," # Step 1 - Load your Google Sheet into pandas\n","\n","# The previous attempt to load the CSV failed because the file was not found.\n","# Please verify the exact path and filename of your CSV in Google Drive.\n","# For example, if it's in a subfolder, the path would be '/content/drive/MyDrive/YourSubfolder/your_file.csv'.\n","# I will add a command to list files in your MyDrive to help you find the correct path.\n","# After running this cell, check the output for the correct file path and update the line below.\n","\n","# List contents of MyDrive to help locate the file\n","!ls '/content/drive/MyDrive/'\n","\n","# Update this line with the correct path to your CSV file\n","df = pd.read_csv(\"/content/drive/MyDrive/Copy of Mental health well-being csv.csv\")\n","print(\"Loaded rows:\", len(df))\n","df.head(6)\n","# _____________________________________________\n","# Step 2 - Quick EDA and cleaning\n","df.columns = [c.strip() for c in df.columns]  # tidy column names\n","print(\"Columns:\", df.columns.tolist())\n","\n","# Show counts and missing values\n","print(df.info())\n","print(\"\\nMissing values per column:\\n\", df.isna().sum())\n","\n","# If Timestamp column exists and is parsed as string, keep as-is (not required for model).\n","# Drop rows with missing target (if any) -- we'll assume \"How much stress you take in your workload?\" is the target.\n","target_col = [c for c in df.columns if 'stress' in c.lower() or 'workload' in c.lower()]\n","print(\"Detected target column candidates:\", target_col)\n","# _____________________________________________\n","# Step 3 - Feature selection + encoding maps\n","# Update these keys to match exact column names from df.columns output\n","col_sleep = \"How many hours do you sleep daily\"\n","col_phone = \"How many hours do you spend on your phone per day?\"\n","col_exercise = \"How often do you exercise?\"\n","col_social = \"How many hours per week do you spend with friends or family (social interaction) ?\"\n","col_caffeine = \"How much caffeine (tea/coffee)?\"\n","col_mood = \"How would you describe your current mood?\"\n","col_workload_stress = \"How much stress you take in your workload?\"\n","\n","# Sanity-check: make sure columns exist\n","for c in [col_sleep, col_phone, col_exercise, col_social, col_caffeine, col_mood, col_workload_stress]:\n","    if c not in df.columns:\n","        raise KeyError(f\"Column not found in sheet: {c}\")\n","\n","# Example ordinal maps (tune as you like)\n","sleep_map = {\n","    \"Less than 4 hours\": 0,\n","    \"4-5 hours\": 1,\n","    \"5-6 hours\": 2,\n","    \"6-8 hours\": 3,\n","    \"more than 8 hours\": 4,\n","    \"More than 8 hours\": 4  # handle capitalization variants\n","}\n","\n","phone_map = {\n","    \"Less than 1 hour\": 0,\n","    \"1-2 hours\": 1,\n","    \"2-4 hours\": 2,\n","    \"4-6 hours\": 3,\n","    \"6-8 hours\": 4,\n","    \"More than 8 hours\": 5,\n","    \"more than 8 hours\": 5\n","}\n","\n","exercise_map = {\n","    \"Never\": 0,\n","    \"Rarely\": 1,\n","    \"Monthly\": 2,\n","    \"Weekly\": 3,\n","    \"Daily\": 4\n","}\n","\n","social_map = {\n","    \"0-2 hours\": 0,\n","    \"3-5 hours\": 1,\n","    \"6- 10 hours\": 2,\n","    \"6-10 hours\": 2,\n","    \"More than 10 hours\": 3,\n","    \"More than 10 hours \": 3\n","}\n","\n","caffeine_map = {\n","    \"Nil\": 0,\n","    \"1-2\": 1,\n","    \"1-2 \": 1,\n","    \"1-2 \": 1,\n","    \"More than 2\": 2,\n","    \"More than 2 \": 2\n","}\n","\n","mood_map = {\n","    \"Happy\": 3,\n","    \"Neutral\": 2,\n","    \"Sad\": 1,\n","    \"Exhausted Right now\": 0,\n","    \"Currently I'm confused as things I planned for this week are not going as planned... Looking up for loopholes\": 1\n","}\n","\n","stress_map = {\n","    \"Not at all\": 0,\n","    \"Minimal\": 1,\n","    \"Mild\": 2,\n","    \"Moderate\": 3,\n","    \"Severe\": 4,\n","    \"Right now Moderate\": 3,\n","    \"Not at all \": 0\n","}\n","\n","# Create a copy and apply maps safely (use .map and fillna with -1 for unknown)\n","df_model = df.copy()\n","df_model['sleep_num'] = df_model[col_sleep].map(sleep_map).fillna(-1).astype(int)\n","df_model['phone_num'] = df_model[col_phone].map(phone_map).fillna(-1).astype(int)\n","df_model['exercise_num'] = df_model[col_exercise].map(exercise_map).fillna(-1).astype(int)\n","df_model['social_num'] = df_model[col_social].map(social_map).fillna(-1).astype(int)\n","df_model['caffeine_num'] = df_model[col_caffeine].map(caffeine_map).fillna(-1).astype(int)\n","df_model['mood_num'] = df_model[col_mood].map(mood_map).fillna(2).astype(int)  # assume neutral if unknown\n","\n","# Target\n","df_model['stress_num'] = df_model[col_workload_stress].map(stress_map).fillna(2).astype(int)\n","\n","# Show a small sample of transformed columns\n","df_model[['sleep_num','phone_num','exercise_num','social_num','caffeine_num','mood_num','stress_num']].head(8)\n","\n","# _____________________________________________\n","\n","# Step 4 - train/test split and model training\n","features = ['sleep_num','phone_num','exercise_num','social_num','caffeine_num','mood_num']\n","X = df_model[features].values\n","y = df_model['stress_num'].values\n","\n","# Remove rows where some feature is -1 (unknown mapping) to keep training clean\n","mask = (X != -1).all(axis=1)\n","X = X[mask]\n","y = y[mask]\n","\n","X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42, stratify=y)\n","\n","clf = RandomForestClassifier(n_estimators=200, random_state=42)\n","clf.fit(X_train, y_train)\n","\n","# Evaluate\n","y_pred = clf.predict(X_test)\n","print(\"Accuracy:\", accuracy_score(y_test, y_pred))\n","print(classification_report(y_test, y_pred))\n","print(\"Confusion matrix:\\n\", confusion_matrix(y_test, y_pred))\n","# _____________________________________________\n","\n","# Step 5 - Save model and encoder objects\n","model_path = \"/content/stress_model.joblib\"\n","joblib.dump({\n","    \"model\": clf,\n","    \"features\": features,\n","    \"sleep_map\": sleep_map,\n","    \"phone_map\": phone_map,\n","    \"exercise_map\": exercise_map,\n","    \"social_map\": social_map,\n","    \"caffeine_map\": caffeine_map,\n","    \"mood_map\": mood_map,\n","    \"stress_map\": stress_map\n","}, model_path)\n","\n","print(\"Saved model artifacts to\", model_path)\n","# _____________________________________________\n","\n","!pip install flask flask-ngrok scikit-learn pandas\n","\n","# _____________________________________________\n","\n","\n","app_py = r\n","from flask import Flask, render_template, request, jsonify\n","import joblib\n","import numpy as np\n","from flask_ngrok import run_with_ngrok # Import run_with_ngrok\n","\n","app = Flask(__name__)\n","artifact = joblib.load(\"/content/stress_model.joblib\")\n","model = artifact['model']\n","\n","# reverse maps for display\n","rev_stress = {v:k for k,v in artifact['stress_map'].items()}\n","\n","# helper to map inputs (same maps used during training)\n","def safe_map(val, mapping, default=0):\n","    # try exact match then lower-case versions\n","    if val in mapping:\n","        return mapping[val]\n","    if isinstance(val, str) and val.strip() in mapping:\n","        return mapping[val.strip()]\n","    if isinstance(val, str) and val.lower().strip() in mapping:\n","        return mapping[val.lower().strip()]\n","    return default\n","\n","# --- Improvement Tips ---\n","def get_recommendations(sleep, phone, exercise, social, caffeine, mood, stress_label):\n","    tips = []\n","\n","    # Sleep\n","    if \"Less\" in sleep or \"4\" in sleep:\n","        tips.append(\"Try to sleep 7–8 hours daily. A consistent sleep schedule greatly reduces stress hormones.\")\n","    elif \"5-6\" in sleep:\n","        tips.append(\"You’re close! Aim for a full 7–8 hours of quality sleep for better emotional balance.\")\n","\n","    # Phone usage\n","    if \"6\" in phone or \"8\" in phone or \"More\" in phone:\n","        tips.append(\"Reduce phone screen time, especially before bed — blue light can worsen stress and sleep quality.\")\n","\n","    # Exercise\n","    if exercise in [\"Never\", \"Rarely\"]:\n","        tips.append(\"Start light physical activity 3–4 times a week — exercise helps release stress-relieving endorphins.\")\n","\n","    # Social interaction\n","    if \"0-2\" in social or \"3-5\" in social:\n","        tips.append(\"Spend more time with friends or family — social support is one of the strongest stress buffers.\")\n","\n","    # Caffeine\n","    if \"More\" in caffeine or caffeine.strip() == \"2\":\n","        tips.append(\"Cut down caffeine intake to 1–2 cups max daily. Excess caffeine triggers anxiety and restlessness.\")\n","\n","    # Mood\n","    if mood in [\"Sad\", \"Exhausted Right now\"]:\n","        tips.append(\"Take short breaks, listen to calming music, or meditate for 10 minutes to reset your mind.\")\n","\n","    # Stress-specific tip\n","    if stress_label in [\"Moderate\", \"Severe\"]:\n","        tips.append(\"You seem to be under noticeable stress. Journaling or deep breathing exercises can help a lot.\")\n","    elif stress_label in [\"Mild\", \"Minimal\"]:\n","        tips.append(\"You’re doing well! Keep maintaining balance and consistency in your daily routine.\")\n","    elif stress_label == \"Not at all\":\n","        tips.append(\"Great! Maintain your healthy habits to keep stress at bay.\")\n","\n","    return tips\n","\n","@app.route('/')\n","def home():\n","    return render_template('home.html')\n","\n","@app.route('/predict form')\n","def index():\n","    return render_template('index.html')\n","\n","@app.route('/predict', methods=['POST'])\n","def predict():\n","    try:\n","        sleep = request.form.get('sleep', '')\n","        phone = request.form.get('phone', '')\n","        exercise = request.form.get('exercise', '')\n","        social = request.form.get('social', '')\n","        caffeine = request.form.get('caffeine', '')\n","        mood = request.form.get('mood', '')\n","\n","        sleep_n = safe_map(sleep, artifact['sleep_map'], default=0)\n","        phone_n = safe_map(phone, artifact['phone_map'], default=0)\n","        exercise_n = safe_map(exercise, artifact['exercise_map'], default=0)\n","        social_n = safe_map(social, artifact['social_map'], default=0)\n","        caffeine_n = safe_map(caffeine, artifact['caffeine_map'], default=0)\n","        mood_n = safe_map(mood, artifact['mood_map'], default=2)\n","\n","        x = np.array([[sleep_n, phone_n, exercise_n, social_n, caffeine_n, mood_n]])\n","        pred = model.predict(x)[0]\n","        label = rev_stress.get(pred, str(pred))\n","        recommendations = get_recommendations(sleep, phone, exercise, social, caffeine, mood, label)\n","\n","        return render_template('result.html', label=label, recommendations=recommendations)\n","\n","    except Exception as e:\n","        return str(e), 400\n","\n","if __name__ == '__main__':\n","    run_with_ngrok(app) # Use run_with_ngrok instead of app.run()\n","    app.run()\n","\n","\n","# Templates (index.html and result.html)\n","home_html = r\n","<!doctype html>\n","<html>\n","<head>\n","  <meta charset=\"utf-8\" />\n","  <title>Welcome | Stress Level Predictor</title>\n","  <style>\n","    body {\n","      font-family: Arial, sans-serif;\n","      background: #fedada;\n","      color: #333;\n","      padding: 50px;\n","      text-align: center;\n","    }\n","    .container {\n","      background: white;\n","      border-radius: 14px;\n","      max-width: 700px;\n","      margin: auto;\n","      padding: 40px;\n","      box-shadow: 0 8px 22px rgba(0,0,0,0.1);\n","    }\n","    h1 { color: #cc8787; margin-bottom: 10px; }\n","    p { font-size: 18px; color:#555; }\n","    a.button {\n","      display: inline-block;\n","      margin-top: 30px;\n","      background: #cc8787;\n","      color: white;\n","      padding: 14px 24px;\n","      text-decoration: none;\n","      font-weight: bold;\n","      border-radius: 10px;\n","      transition: background 0.3s;\n","    }\n","    a.button:hover { background: #b46969; }\n","  </style>\n","</head>\n","<body>\n","  <div class=\"container\">\n","    <h1>Welcome to the Stress Level Predictor</h1>\n","    <p>Take a short test to find out your current stress level</p>\n","    <a href=\"/predict form\" class=\"button\">Take Test</a>\n","  </div>\n","</body>\n","</html>\n","\n","\n","\n","index_html = r\n","<!doctype html>\n","<html>\n","<head>\n","  <meta charset=\"utf-8\" />\n","  <title>Stress Level Predictor</title>\n","  <style>\n","    body { font-family: Arial, sans-serif; background: #fedada; color: #333; padding: 30px; }\n","    .card { background: white; border-radius: 12px; padding: 22px; max-width: 640px; margin: auto; box-shadow: 0 6px 18px rgba(0,0,0,0.08); }\n","    h1 { color: #cc8787; text-align: center; }\n","    label { display:block; margin-top:12px; font-weight:600; }\n","    select, input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #eee; margin-top:6px; box-sizing:border-box; }\n","    button { margin-top: 16px; width: 100%; background: #cc8787; color: white; padding: 12px; border: none; border-radius: 10px; font-weight:700; cursor:pointer; }\n","    small { color:#666; }\n","  </style>\n","</head>\n","<body>\n","  <div class=\"card\">\n","    <h1>Stress Level Predictor</h1>\n","    <form action=\"/predict\" method=\"post\">\n","      <label>How many hours do you sleep daily?</label>\n","      <select name=\"sleep\">\n","        <option>Less than 4 hours</option>\n","        <option>5-6 hours</option>\n","        <option>6-8 hours</option>\n","        <option>more than 8 hours</option>\n","      </select>\n","\n","      <label>Phone usage per day</label>\n","      <select name=\"phone\">\n","        <option>Less than 1 hour</option>\n","        <option>1-2 hours</option>\n","        <option>2-4 hours</option>\n","        <option>4-6 hours</option>\n","        <option>6-8 hours</option>\n","        <option>More than 8 hours</option>\n","      </select>\n","\n","      <label>How often do you exercise?</label>\n","      <select name=\"exercise\">\n","        <option>Never</option>\n","        <option>Rarely</option>\n","        <option>Monthly</option>\n","        <option>Weekly</option>\n","        <option>Daily</option>\n","      </select>\n","\n","      <label>Hours/week social interaction</label>\n","      <select name=\"social\">\n","        <option>0-2 hours</option>\n","        <option>3-5 hours</option>\n","        <option>6-10 hours</option>\n","        <option>More than 10 hours</option>\n","      </select>\n","\n","      <label>Caffeine intake</label>\n","      <select name=\"caffeine\">\n","        <option>Nil</option>\n","        <option>1-2</option>\n","        <option>More than 2</option>\n","      </select>\n","\n","      <label>Current mood</label>\n","      <select name=\"mood\">\n","        <option>Happy</option>\n","        <option>Neutral</option>\n","        <option>Sad</option>\n","        <option>Exhausted Right now</option>\n","      </select>\n","\n","      <button type=\"submit\">Predict Stress</button>\n","    </form>\n","    <p style=\"margin-top:12px;\"><small>Model trained from survey data. Use as a guide, not medical advice.</small></p>\n","  </div>\n","</body>\n","</html>\n","\n","\n","\n","result_html = r\n","<!doctype html>\n","<html>\n","<head>\n","  <meta charset=\"utf-8\" />\n","  <title>Stress Level Result</title>\n","  <style>\n","    body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #ffe5e5, #fff0f0); color: #333; padding: 30px; }\n","    .card { background: white; border-radius: 18px; padding: 28px; max-width: 720px; margin: auto;\n","            box-shadow: 0 6px 18px rgba(0,0,0,0.1); text-align:center; }\n","    h1 { color: #cc7878; font-size: 32px; margin-bottom: 15px; }\n","    .label { font-size: 24px; margin-top: 10px; font-weight:700; color:#444; }\n","    .recommendations { margin-top: 24px; text-align: left; background:#fff6f6; padding:18px; border-radius:12px; }\n","    .recommendations h2 { font-size: 22px; color:#cc7878; margin-bottom:10px; }\n","    .recommendations ul { list-style-type: disc; margin-left:25px; }\n","    a { display:inline-block; margin-top:20px; text-decoration:none; padding:12px 18px;\n","        background:#cc7878; color:#fff; border-radius:8px; font-weight:600; transition:0.3s; }\n","    a:hover { background:#b86c6c; }\n","  </style>\n","</head>\n","<body>\n","  <div class=\"card\">\n","    <h1>Predicted Stress Level</h1>\n","    <div class=\"label\">{{ label }}</div>\n","\n","    <div class=\"recommendations\">\n","      <h2>Personalized Tips to Improve Stress:</h2>\n","      <ul>\n","        {% for tip in recommendations %}\n","          <li>{{ tip }}</li>\n","        {% endfor %}\n","      </ul>\n","    </div>\n","\n","    <a href=\"/\"> Try Again</a>\n","  </div>\n","</body>\n","</html>\n","\n","\n","# Write files\n","with open('/content/app.py', 'w') as f:\n","    f.write(app_py)\n","os.makedirs('/content/templates', exist_ok=True)\n","with open('/content/templates/home.html', 'w') as f:\n","    f.write(home_html)\n","with open('/content/templates/index.html', 'w') as f:\n","    f.write(index_html)\n","with open('/content/templates/result.html', 'w') as f:\n","    f.write(result_html)\n","\n","print(\"Created Flask app at /content/app.py and templates. Next step: run with ngrok to expose on the internet (Colab).\")\n","\n","# _____________________________________________\n","\n","!pip install pyngrok\n","\n","from pyngrok import ngrok\n","\n","!pkill -f ngrok\n","\n","# IMPORTANT: Replace \"YOUR_AUTHTOKEN_HERE\" with your actual ngrok authtoken from https://dashboard.ngrok.com/get-started/your-authtoken\n","ngrok.set_auth_token(\"35vwCaV34pErpZOEIDtcibKYqBR_6wrvS5149RyvgzgrowASH\")\n","public_url = ngrok.connect(5000)\n","print(\"public_url:\", public_url)\n","\n","# No need to run !python app.py separately since run_with_ngrok(app) handles it now\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":106},"id":"3VJSmbQltITj","executionInfo":{"status":"error","timestamp":1764007209906,"user_tz":-330,"elapsed":486,"user":{"displayName":"","userId":""}},"outputId":"7745f21a-7f5b-4f6e-f120-96c2d56b5d57"},"execution_count":12,"outputs":[{"output_type":"error","ename":"SyntaxError","evalue":"invalid decimal literal (ipython-input-630076199.py, line 306)","traceback":["\u001b[0;36m  File \u001b[0;32m\"/tmp/ipython-input-630076199.py\"\u001b[0;36m, line \u001b[0;32m306\u001b[0m\n\u001b[0;31m    padding: 50px;\u001b[0m\n\u001b[0m              ^\u001b[0m\n\u001b[0;31mSyntaxError\u001b[0m\u001b[0;31m:\u001b[0m invalid decimal literal\n"]}]},{"cell_type":"code","source":["from google.colab import drive\n","drive.mount('/content/drive')"],"metadata":{"id":"eJplhhTXyFrC"},"execution_count":null,"outputs":[]}],"metadata":{"colab":{"name":"Welcome To Colab","provenance":[{"file_id":"/v2/external/notebooks/intro.ipynb","timestamp":1764007776133}]},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}